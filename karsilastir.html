<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÃœrÃ¼n KarÅŸÄ±laÅŸtÄ±rma - Medikal Estetik AtlasÄ±</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">ğŸ¥ Medikal Estetik AtlasÄ±</a>
            <div class="nav-links">
                <a href="/">ÃœrÃ¼nler</a>
                <a href="/doktorlar.html">Doktorlar</a>
                <a href="/karsilastir.html" class="active">KarÅŸÄ±laÅŸtÄ±rma</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <h1>ÃœrÃ¼n KarÅŸÄ±laÅŸtÄ±rma</h1>
        <p class="compare-info">Maksimum 3 Ã¼rÃ¼nÃ¼ yan yana karÅŸÄ±laÅŸtÄ±rabilirsiniz.</p>

        <div class="comparison-container">
            <div class="comparison-table-wrapper">
                <table class="comparison-table" id="karsilastirmaTablosu">
                    <thead>
                        <tr id="urunBasliklar">
                            <th>Ã–zellikler</th>
                            <th id="urun1Baslik" class="product-col">
                                <button onclick="urunSec(1)" class="sec-btn">ÃœrÃ¼n SeÃ§</button>
                            </th>
                            <th id="urun2Baslik" class="product-col">
                                <button onclick="urunSec(2)" class="sec-btn">ÃœrÃ¼n SeÃ§</button>
                            </th>
                            <th id="urun3Baslik" class="product-col">
                                <button onclick="urunSec(3)" class="sec-btn">ÃœrÃ¼n SeÃ§</button>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="karsilastirmaGovde">
                        <!-- TÃ¼m alanlar buraya JS ile eklenecek -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ÃœrÃ¼n SeÃ§im ModalÄ± -->
        <div id="urunModal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="modalKapat()">&times;</span>
                <h2>ÃœrÃ¼n SeÃ§in</h2>
                <input type="text" id="modalArama" placeholder="ÃœrÃ¼n ara..." onkeyup="modalUrunAra()">
                <div id="modalUrunListesi" class="modal-list">
                    <!-- ÃœrÃ¼nler listelenecek -->
                </div>
            </div>
        </div>
    </main>

    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>
    <script>
        // KarÅŸÄ±laÅŸtÄ±rma alanlarÄ± tanÄ±mÄ±
        const karsilastirmaAlanlari = [
            { key: 'urun_adi', label: 'ÃœrÃ¼n AdÄ±', tip: 'text' },
            { key: 'firma_adi', label: 'Firma', tip: 'text' },
            { key: 'kategori', label: 'Kategori', tip: 'text' },
            { key: 'uygulama_alanlari', label: 'UygulandÄ±ÄŸÄ± Alanlar', tip: 'text' },
            { key: 'derinlik', label: 'Derinlik', tip: 'text' },
            { key: 'etki_baslangici', label: 'Etki BaÅŸlangÄ±cÄ±', tip: 'text' },
            { key: 'etki_suresi', label: 'Etki SÃ¼resi', tip: 'text' },
            { key: 'hazirlanmasi', label: 'HazÄ±rlanmasÄ±', tip: 'text' },
            { key: 'saklama_kosullari', label: 'Saklama KoÅŸullarÄ±', tip: 'text' },
            { key: 'rekons_stresi', label: 'Rekons SÃ¼resi', tip: 'text' },
            { key: 'teknolojisi', label: 'Teknolojisi', tip: 'text' },
            { key: 'endikasyonlar', label: 'Endikasyonlar', tip: 'text' },
            { key: 'etkilesimler', label: 'EtkileÅŸimler', tip: 'text' },
            { key: 'kontrendikasyonlar', label: 'Kontrendikasyonlar', tip: 'text' },
            { key: 'sinif', label: 'Class (1-2-3)', tip: 'select', options: ['1', '2', '3'] },
            { key: 'fda_onay', label: 'FDA OnayÄ±', tip: 'select', options: ['OnaylÄ±', 'OnaysÄ±z'] },
            { key: 'ce_belgesi', label: 'CE Belgesi', tip: 'select', options: ['Evet', 'HayÄ±r'] },
            { key: 'uts_kayit', label: 'ÃœTS KayÄ±t', tip: 'select', options: ['Evet', 'HayÄ±r'] },
            { key: 'kutu_fiyati', label: 'Kutu FiyatÄ±', tip: 'fiyat' },
            { key: 'kutu_icerigi', label: 'Kutu Ä°Ã§eriÄŸi', tip: 'text' },
            { key: 'adet_fiyati', label: 'Adet FiyatÄ±', tip: 'fiyat' },
            { key: 'aciklama', label: 'ÃœrÃ¼n AÃ§Ä±klamasÄ±', tip: 'textarea' },
            { key: 'satin_alma_linki', label: 'SatÄ±n Alma Linki', tip: 'link' }
        ];

        let seciliUrunler = { 1: null, 2: null, 3: null };
        let aktifSecim = null;

        function tabloOlustur() {
            const tbody = document.getElementById('karsilastirmaGovde');
            tbody.innerHTML = '';
            
            karsilastirmaAlanlari.forEach(alan => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="feature-name">${alan.label}</td>
                    <td id="urun1_${alan.key}" class="product-data">-</td>
                    <td id="urun2_${alan.key}" class="product-data">-</td>
                    <td id="urun3_${alan.key}" class="product-data">-</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function urunSec(sira) {
            aktifSecim = sira;
            document.getElementById('urunModal').style.display = 'block';
            modalUrunleriYukle();
        }

        function modalKapat() {
            document.getElementById('urunModal').style.display = 'none';
        }

        async function modalUrunleriYukle() {
            const { data: urunler } = await supabase.from('urunler').select('*');
            const liste = document.getElementById('modalUrunListesi');
            liste.innerHTML = urunler.map(u => `
                <div class="modal-item" onclick="urunAta('${u.id}')">
                    <strong>${u.urun_adi}</strong>
                    <small>${u.firma_adi} - ${u.kategori}</small>
                </div>
            `).join('');
        }

        async function urunAta(urunId) {
            const { data: urun } = await supabase.from('urunler').select('*').eq('id', urunId).single();
            seciliUrunler[aktifSecim] = urun;
            
            // BaÅŸlÄ±ÄŸÄ± gÃ¼ncelle
            document.getElementById(`urun${aktifSecim}Baslik`).innerHTML = `
                <div class="selected-product">
                    <h3>${urun.urun_adi}</h3>
                    <button onclick="urunKaldir(${aktifSecim})" class="remove-btn">KaldÄ±r</button>
                </div>
            `;
            
            // Verileri doldur
            karsilastirmaAlanlari.forEach(alan => {
                const hÃ¼cre = document.getElementById(`urun${aktifSecim}_${alan.key}`);
                let deger = urun[alan.key] || '-';
                
                if(alan.tip === 'fiyat' && deger !== '-') {
                    deger = 'â‚º' + parseFloat(deger).toLocaleString('tr-TR');
                } else if(alan.tip === 'link' && deger !== '-') {
                    deger = `<a href="${deger}" target="_blank" class="buy-link">SatÄ±n Al â†’</a>`;
                }
                
                hÃ¼cre.innerHTML = deger;
            });
            
            modalKapat();
        }

        function urunKaldir(sira) {
            seciliUrunler[sira] = null;
            document.getElementById(`urun${sira}Baslik`).innerHTML = `
                <button onclick="urunSec(${sira})" class="sec-btn">ÃœrÃ¼n SeÃ§</button>
            `;
            karsilastirmaAlanlari.forEach(alan => {
                document.getElementById(`urun${sira}_${alan.key}`).innerHTML = '-';
            });
        }

        // Ä°lk yÃ¼kleme
        tabloOlustur();
    </script>
</body>
</html>